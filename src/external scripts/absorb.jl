function absorb_all(freq, temp, pres, vapor_pres, clw)
    rho = vapor_pres * 100 * 18 / (8.314 * temp)
    kabs_H2O = abs_H2O(temp, pres, rho, freq)
    kabs_O2 = abs_O2(temp, pres, rho, freq)
    kabs_N2 = abs_N2(temp, pres, freq)
    kabs_clw = absorb_clw(freq, temp, clw)
    kabs_all = kabs_H2O + kabs_O2 + kabs_N2 + kabs_clw
    return kabs_all
end

function abs_H2O(temp, pres, rho, freq)
    if rho <= 0
        return 0.0
    end

    NLINES = 15
    FL = [22.2351, 183.3101, 321.2256, 325.1529, 380.1974, 439.1508, 443.0183, 448.0011, 470.8890, 474.6891, 488.4911, 556.9360, 620.7008, 752.0332, 916.1712]
    S1 = [0.1314e-13, 0.2279e-11, 0.8058e-13, 0.2701e-11, 0.2444e-10, 0.2185e-11, 0.4637e-12, 0.2568e-10, 0.8392e-12, 0.3272e-11, 0.6676e-12, 0.1535e-08, 0.1711e-10, 0.1014e-08, 0.4238e-10]
    B2 = [2.144, 0.668, 6.179, 1.541, 1.048, 3.595, 5.048, 1.405, 3.597, 2.379, 2.852, 0.159, 2.391, 0.396, 1.441]
    W3 = [0.00281, 0.00287, 0.0023, 0.00278, 0.00287, 0.0021, 0.00186, 0.00263, 0.00215, 0.00236, 0.0026, 0.00321, 0.00244, 0.00306, 0.00267]
    X = [0.69, 0.64, 0.67, 0.68, 0.54, 0.63, 0.60, 0.66, 0.66, 0.65, 0.69, 0.69, 0.71, 0.68, 0.70]
    WS = [0.01349, 0.01491, 0.0108, 0.0135, 0.01541, 0.0090, 0.00788, 0.01275, 0.00983, 0.01095, 0.01313, 0.01320, 0.01140, 0.01253, 0.01275]
    XS = [0.61, 0.85, 0.54, 0.74, 0.89, 0.52, 0.50, 0.67, 0.65, 0.64, 0.72, 1.0, 0.68, 0.84, 0.78]
    SR = [0.0, -0.017, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

    PVAP = rho * temp / 217.0
    PDA = pres - PVAP
    DEN = 3.335e16 * rho
    TI = 300.0 / temp
    TI2 = TI^2.5

    CON = (5.43e-10 * PDA * TI^3 + 1.8e-8 * PVAP * TI^7.5) * PVAP * freq^2

    SUM = 0.0
    for i in 1:NLINES
        WIDTH = W3[i] * PDA * TI^X[i] + WS[i] * PVAP * TI^XS[i]
        SHIFT = SR[i] * WIDTH
        WSQ = WIDTH^2
        S = S1[i] * TI2 * exp(B2[i] * (1.0 - TI))
        DF1 = freq - FL[i] - SHIFT
        DF2 = freq + FL[i] + SHIFT
        BASE = WIDTH / (562500.0 + WSQ)
        RES = 0.0
        if abs(DF1) < 750.0
            RES += WIDTH / (DF1^2 + WSQ) - BASE
        end
        if abs(DF2) < 750.0
            RES += WIDTH / (DF2^2 + WSQ) - BASE
        end
        SUM += S * RES * (freq / FL[i])^2
    end

    kabs_H2O = 0.3183e-4 * DEN * SUM + CON
    return kabs_H2O
end

function abs_O2(temp, pres, vapor_pres, freq)
    TH = 300.0 / temp
    TH1 = TH - 1.0
    B = TH^0.8
    PRESWV = vapor_pres * temp / 217.0
    PRESDA = pres - PRESWV
    DEN = 0.001 * (PRESDA * B + 1.1 * PRESWV * TH)
    DENS = 0.001 * (PRESDA * TH^0.9 + 1.1 * PRESWV * TH)
    DFNR = 0.56 * DEN
    SUM = 1.6e-17 * freq^2 * DFNR / (TH * (freq^2 + DFNR^2))

    F = [118.7503, 56.2648, 62.4863, 58.4466, 60.3061, 59.5910, 59.1642, 60.4348, 58.3239, 61.1506, 57.6125, 61.8002, 56.9682, 62.4112, 56.3634, 62.9980, 55.7838, 63.5685, 55.2214, 64.1278, 54.6712, 64.6789, 54.1300, 65.2241, 53.5957, 65.7648, 53.0669, 66.3021, 52.5424, 66.8368, 52.0214, 67.3696, 51.5034, 67.9009, 368.4984, 424.7632, 487.2494, 715.3931, 773.8397, 834.1458]
    S300 = [0.2936e-14, 0.8079e-15, 0.2480e-14, 0.2228e-14, 0.3351e-14, 0.3292e-14, 0.3721e-14, 0.3891e-14, 0.3640e-14, 0.4005e-14, 0.3227e-14, 0.3715e-14, 0.2627e-14, 0.3156e-14, 0.1982e-14, 0.2477e-14, 0.1391e-14, 0.1808e-14, 0.9124e-15, 0.1230e-14, 0.5603e-15, 0.7842e-15, 0.3228e-15, 0.4689e-15, 0.1748e-15, 0.2632e-15, 0.8898e-16, 0.1389e-15, 0.4264e-16, 0.6899e-16, 0.1924e-16, 0.3229e-16, 0.8191e-17, 0.1423e-16, 0.6494e-15, 0.7083e-14, 0.3025e-14, 0.1835e-14, 0.1158e-13, 0.3993e-14]
    BE = [0.009, 0.015, 0.083, 0.084, 0.212, 0.212, 0.391, 0.391, 0.626, 0.626, 0.915, 0.915, 1.260, 1.260, 1.660, 1.660, 2.119, 2.119, 2.624, 2.624, 3.194, 3.194, 3.814, 3.814, 4.484, 4.484, 5.224, 5.224, 6.004, 6.004, 6.844, 6.844, 7.744, 7.744, 0.048, 0.044, 0.049, 0.145, 0.141, 0.145]
    W300 = [1.67, 1.646, 1.468, 1.449, 1.382, 1.360, 1.319, 1.297, 1.266, 1.248, 1.221, 1.207, 1.181, 1.171, 1.144, 1.139, 1.110, 1.108, 1.079, 1.078, 1.05, 1.05, 1.02, 1.02, 1.00, 1.00, 0.97, 0.97, 0.94, 0.94, 0.92, 0.92, 0.89, 0.89, 1.64, 1.64, 1.81, 1.81, 1.81, 1.81]
    Y300 = [-0.036, 0.2408, -0.3486, 0.5227, -0.5430, 0.5877, -0.3970, 0.3237, -0.1348, 0.0311, 0.0725, -0.1663, 0.2832, -0.3629, 0.3970, -0.4599, 0.4695, -0.5199, 0.5187, -0.5597, 0.5903, -0.6246, 0.6656, -0.6942, 0.7086, -0.7325, 0.7348, -0.7546, 0.7702, -0.7864, 0.8083, -0.8210, 0.8439, -0.8529, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]
    V = [0.0079, -0.0978, 0.0844, -0.1273, 0.0699, -0.0776, 0.2309, -0.2825, 0.0436, -0.0584, 0.6056, -0.6619, 0.6451, -0.6759, 0.6547, -0.6675, 0.6135, -0.6139, 0.2952, -0.2895, 0.2654, -0.2590, 0.3750, -0.3680, 0.5085, -0.5002, 0.6206, -0.6091, 0.6526, -0.6393, 0.6640, -0.6475, 0.6729, -0.6545, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0]

    for k in 1:40
        if k == 1
            DF = W300[1] * DENS
        else
            DF = W300[k] * DEN
        end
        FCEN = F[k]
        Y = 0.001 * pres * B * (Y300[k] + V[k] * TH1)
        STR = S300[k] * exp(-BE[k] * TH1)
        SF1 = (DF + (freq - FCEN) * Y) / ((freq - FCEN)^2 + DF^2)
        SF2 = (DF - (freq + FCEN) * Y) / ((freq + FCEN)^2 + DF^2)
        SUM += STR * (SF1 + SF2) * (freq / F[k])^2
    end

    O2ABS = 0.5034e12 * SUM * PRESDA * TH^3 / Ï€
    return max(O2ABS, 0.0)
end

function abs_N2(temp, pres, freq)
    TH = 300.0 / temp
    FDEPEN = 0.5 + 0.5 / (1.0 + (freq / 450.0)^2)
    BF = 6.5e-14 * FDEPEN * pres^2 * freq^2 * TH^3.6
    ABSN2 = 1.29 * BF
    return ABSN2
end

function absorb_clw(freq, temp, water)
    if water <= 0
        return 0.0
    end

    THETA1 = 1.0 - 300.0 / temp
    EPS0 = 77.66 - 103.3 * THETA1
    EPS1 = 0.0671 * EPS0
    EPS2 = 3.52
    FP = 20.1 * exp(7.88 * THETA1)
    FS = 39.8 * FP
    EPS = (EPS0 - EPS1) / complex(1.0, freq / FP) + (EPS1 - EPS2) / complex(1.0, freq / FS) + EPS2
    RE = (EPS - 1.0) / (EPS + 2.0)
    kabs_clw = -0.06286 * imag(RE) * freq * water
    return kabs_clw
end

# Test the function
freq = 200
temp = 300.0
pres = 1000.0
wv = 23.0
clw = 10.0